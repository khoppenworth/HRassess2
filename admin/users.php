<?php require_once __DIR__.'/../config.php'; require_once __DIR__.'/../helpers.php'; require_once __DIR__.'/../i18n.php'; require_auth(['admin']);
$msg=''; if($_SERVER['REQUEST_METHOD']==='POST'&&isset($_POST['create'])){$u=trim($_POST['username']??'');$p=$_POST['password']??'';$r=$_POST['role']??'staff';if($u&&$p){$st=$pdo->prepare('INSERT INTO users (username,password,role,full_name,email) VALUES (?,?,?,?,?)');$st->execute([$u,password_hash($p,PASSWORD_DEFAULT),$r,$_POST['full_name']??null,$_POST['email']??null]);$msg='User created';}}
if(isset($_GET['delete'])){$id=(int)$_GET['delete'];$pdo->prepare('DELETE FROM users WHERE id=?')->execute([$id]);redirect('/admin/users.php');}
$rows=$pdo->query('SELECT id,username,role,full_name,email,created_at FROM users ORDER BY id DESC')->fetchAll();
include __DIR__.'/../templates/header.php'; ?><h2><?=h(t('users'))?></h2><?php if($msg):?><div class="alert success"><?=h($msg)?></div><?php endif; ?>
<form method="post"><input type="hidden" name="create" value="1"><div class="row"><label>Username</label><input name="username" required></div><div class="row"><label>Password</label><input type="password" name="password" required></div><div class="row"><label>Role</label><select name="role"><option>staff</option><option>admin</option></select></div><div class="row"><label>Full name</label><input name="full_name"></div><div class="row"><label>Email</label><input type="email" name="email"></div><p><button class="btn"><?=h(t('create'))?></button></p></form>
<table><tr><th>ID</th><th>User</th><th>Role</th><th>Name</th><th>Email</th><th>Created</th><th></th></tr><?php foreach($rows as $r):?><tr><td><?=$r['id']?></td><td><?=h($r['username'])?></td><td><?=h($r['role'])?></td><td><?=h($r['full_name'])?></td><td><?=h($r['email'])?></td><td><?=h($r['created_at'])?></td><td><a class="btn" href="?delete=<?=$r['id']?>" onclick="return confirm('Delete user?')"><?=h(t('delete'))?></a></td></tr><?php endforeach; ?></table><?php include __DIR__.'/../templates/footer.php'; ?>
