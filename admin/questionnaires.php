<?php require_once __DIR__.'/../config.php'; require_once __DIR__.'/../helpers.php'; require_once __DIR__.'/../i18n.php'; require_auth(['admin']);
if($_SERVER['REQUEST_METHOD']==='POST'&&isset($_POST['create_q'])){$st=$pdo->prepare('INSERT INTO questionnaires (code,title,description,created_by) VALUES (?,?,?,?)');$st->execute([trim($_POST['code']??''),trim($_POST['title']??''),$_POST['description']??'',current_user()['id']??null]);$id=(int)$pdo->lastInsertId();redirect('/admin/questionnaire_edit.php?id='.$id);}
$rows=$pdo->query('SELECT id,code,title,created_at FROM questionnaires ORDER BY id DESC')->fetchAll();
include __DIR__.'/../templates/header.php'; ?><h2><?=h(t('questionnaires'))?></h2>
<form method="post"><input type="hidden" name="create_q" value="1"><div class="row"><label>Code</label><input name="code"></div><div class="row"><label>Title</label><input name="title" required></div><div class="row"><label>Description</label><textarea name="description"></textarea></div><p><button class="btn"><?=h(t('create'))?></button></p></form>
<table><tr><th>ID</th><th>Code</th><th>Title</th><th>Created</th><th></th></tr><?php foreach($rows as $r):?><tr><td><?=$r['id']?></td><td><?=h($r['code'])?></td><td><?=h($r['title'])?></td><td><?=h($r['created_at'])?></td><td><a class="btn" href="/admin/questionnaire_edit.php?id=<?=$r['id']?>"><?=h(t('edit'))?></a></td></tr><?php endforeach; ?></table><?php include __DIR__.'/../templates/footer.php'; ?>
