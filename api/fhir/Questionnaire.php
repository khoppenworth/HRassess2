<?php require_once __DIR__.'/../common.php'; api_authenticate($pdo);
$id=(int)($_GET['id']??0); if($id){$q=$pdo->prepare('SELECT * FROM questionnaires WHERE id=?');$q->execute([$id]);$qn=$q->fetch(); if(!$qn){json_out(['resourceType'=>'OperationOutcome','issue'=>[['severity'=>'error','diagnostics'=>'Not found']]],404);} $qs=$pdo->prepare('SELECT * FROM questions WHERE questionnaire_id=? ORDER BY id');$qs->execute([$id]);$items=[]; foreach($qs as $r){$items[]=['linkId'=>(string)$r['id'],'text'=>$r['text'],'type'=>'integer','maxValueInteger'=>(int)$r['max_score']];} json_out(['resourceType'=>'Questionnaire','id'=>(string)$qn['id'],'title'=>$qn['title'],'status'=>'active','item'=>$items]);}
$rows=$pdo->query('SELECT id,title FROM questionnaires ORDER BY id DESC')->fetchAll(); json_out(array_map(fn($r)=>['resourceType'=>'Questionnaire','id'=>(string)$r['id'],'title'=>$r['title'],'status'=>'active'],$rows));
